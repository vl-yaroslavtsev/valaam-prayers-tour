<!--suppress HtmlUnknownTarget -->
<template>
	<div class="page" data-name="calendar">

		<!-- Top Navbar -->
		<div class="navbar navbar-collapse">
			<div class="navbar-bg"></div>
			<div class="navbar-inner sliding">
				<div class="left">
					<a href="#" class="link back">
						<i class="icon icon-back"></i>
						<span class="">Назад</span>
					</a>
				</div>
				<div class="title">{{title}} в {{year}} году</div>
				<div class="right">
				{{> "navbar-right"}}
				</div>
			</div>
		</div>

		<!-- Scrollable page content-->
		<div class="page-content">
			<div class="page-title">
				{{title}} в {{year}} году
			</div>
			{{#if description}}
			<div class="block text-white">
				{{description}}
			</div>
			{{/if}}
			<div class="tile">
				{{> "calendar-holidays-list"}}
			</div>
		</div>
	</div>
</template>
<style scoped>
	.list .item-title {
    	white-space: normal;
	}
</style>
<script>
	import {
		parseRelative,
		format
	} from '../js/utils/date-utils.js';

	export default {
		on: {
			pageAfterIn: function(e, page) {
				// if(this.$root.debug)
				// 	this.$router.navigate('/days/20190428', {});
			}
		},
		data() {
			const year = this.$route.params.year || format(new Date(), 'YYYY');
			const type = this.$route.params.type;

			return getData(type, year);
		}
	}

	/** Конвертируем переходящую дату в строку типа yyyyMMdd 
	 * @param {string} str Строка в формате функции parseRelative
	 * @return {string} Cтрока в формате yyyyMMdd
	*/
	function convert(str) {
		return format(parseRelative(str));
	} 

	function getData(type, year) {
		let data;

		switch (type) {
			case 'twelve':
			data = {
				title: 'Двунадесятые праздники',
				description: `
					Двунадесятые праздники – двенадцать важнейших после Пасхи церковных праздников.
					Посвящены событиям земной жизни Спасителя и Богородицы.
					В богослужебных книгах отмечаются знаком красного креста в круге.
					У каждого из них существует предпразднство, попразднство и отдание.
				`,
				holidays: [
					{
						name: "Двунадесятые переходящие праздники",
						desc: "Отсчитываются от Пасхи и перемещаются в пространстве «светского» календаря вместе с ней.",
						items: {
							[convert('E-7')]: "Вход Господень в Иерусалим",
							[convert('E+39')]: "Вознесение Господне",
							[convert('E+49')]: "День Святой Троицы. Пятидесятница"
						}
					},
					{
						name: "Двунадесятые непереходящие праздники",
						desc: "Всегда приходятся на строго определенное число месяца, вне зависимости от дня недели, ежегодно меняющегося.",
						items: {
							[convert('Y0119')]: "Крещение Господне. Богоявление",
							[convert('Y0215')]: "Сретение Господне",
							[convert('Y0407')]: "Благовещение Пресвятой Богородицы",
							[convert('Y0819')]: "Преображение Господне",
							[convert('Y0828')]: "Успение Пресвятой Богородицы",
							[convert('Y0921')]: "Рождество Пресвятой Богородицы",
							[convert('Y0927')]: "Воздвижение Креста Господня",
							[convert('Y1204')]: "Введение во храм Пресвятой Богородицы",
							[convert('Y0107')]: "Рождество Христово"
						}
					}
				]
			};
			break;

			case 'grand':
			data = {
				title: 'Великие праздники',
				description: `
				В день великого праздника совершается Всенощное бдение.
				В богослужебных книгах отмечаются знаком красного креста в круге.
				У великих недвунадесятых праздников предпразднства, попразднства и отдания нет.
				`,
				holidays: [
					{
						items: {
							[convert('Y0114')]: "Обрезание Господне и память святителя Василия Великого",
							[convert('Y0707')]: "Рождество Иоанна Предтечи",
							[convert('Y0712')]: "святых первоверховных апостолов Петра и Павла",
							[convert('Y0911')]: "Усекновение главы Иоанна Предтечи",
							[convert('Y1014')]: "Покров Пресвятой Богородицы"
						}
					}
				]
			};
			break;

			case 'valaam':
			data = {
				title: 'Праздники Валаамской обители',
				description: `
				Памяти икон Пресвятой Богородицы и святых, особо почитаемые на Валааме.
				`,
				holidays: [{
					items: {
						// Первое воскресение после прпп. Сергия и Германа Валаамских (11 июля)
						[convert('SU>0713')]: "Валаамской иконы Божией Матери",
						// Первое воскресение после Преображения (19 августа)
						[convert('SU>0820')]: "Собор Всех Валаамских святых",
						[convert('Y1213')]: "День возрождения Валаамского монастыря",
						[convert('Y1111')]: "Прп. Авраамий Ростовский",
						[convert('Y0711')]: "Прпп. Сергий и Герман Валаамские чудотворцы",
						[convert('Y0924')]: "Прпп. Сергий и Герман Валаамские чудотворцы (перенесение мощей)",
						[convert('Y0625')]: "Прп. Арсений Коневский",
						[convert('Y0430')]: "Прп. Александр Свирский",
						[convert('Y0912')]: "Прп. Александр Свирский",
						[convert('Y0305')]: "34 преподобномученика Валаамских",
						[convert('Y0308')]: "Прп. Назарий Валаамский, Саровский",
						[convert('Y0809')]: "Прп. Герман Аляскинский",
						[convert('Y1128')]: "Прп. Герман Аляскинский",
						[convert('Y0513')]: "Свт. Игнатий (Брянчанинов)",
						[convert('Y0123')]: "Прп. Антипа Валаамский, Афонский",
						[convert('Y1220')]: "Прмч. Андроник (Барсуков)",
						[convert('Y1220')]: "Прмч. Сергий (Гальковский)",
						[convert('Y0114')]: "Прмч. Иеремия (Леонов)",
						[convert('Y1106')]: "Присп. Арефа (Митренин)",
						[convert('Y0324')]: "Присп. Патрикий (Петров)",
						[convert('Y0820')]: "Прмч. Афанасий (Егоров)",
						[convert('Y0607')]: "Прмч. Таврион (Толоконцев)",
						[convert('Y1220')]: "Прмч. Галактион (Урбанович – Новиков)",
						[convert('Y1206')]: "Блгв. вел. кн. Александр Невский",
						/*[formatEndOfWeek(convert('Y0819`)]: "Прп. Илия Верхотурский"*/
					}
				}]
			};
			break;

			case 'fasting':
			data = {
				title: 'Посты',
				description: `
				В Русской Православной Церкви существует четыре многодневных поста,
				посты в среду и пятницу в течение всего года (за исключением пяти седмиц),
				три однодневных поста.
				`,
				holidays: [
					{
						name: "Многодневные посты",
						items: {
							[convert('E-48')]: "Великий пост (начало)",
							[convert('E-1')]: "Великий пост (конец)",
							[convert('E+57')]: "Петров пост (начало)",
							[convert('Y0711')]: "Петров пост (конец)",
							[convert('Y0814')]: "Успенский пост (начало)",
							[convert('Y0827')]: "Успенский пост (конец)",
							[convert('Y1128')]: "Рождественский пост (начало)",
							[convert('Y0106')]: "Рождественский пост (конец)"
						}
					},
					{
						name: "Однодневные посты",
						desc: `Среда и пятница в течение всего года,
						за исключением сплошных седмиц и Святок
						`,
						items: {
							[convert('Y0118')]: "Крещенский сочельник (Навечерие Богоявления)",
							[convert('Y0911')]: "Усекновение главы Иоанна Предтечи",
							[convert('Y0927')]: "Воздвижение Креста Господня"
						}
					}
				]
			};
			break;

			case 'solid':
			data = {
				title: 'Сплошные седмицы',
				description: `
				Седмица – неделя с понедельника по воскресенье.
				В эти дни нет поста в среду и пятницу.
				`,
				holidays: [
					{
						name: 'Святки',
						desc: `Святые дни между праздниками Рождества Христова и Его Крещения`,
						items: {
							[convert('Y0107')]: "Начало Святок",
							[convert('Y0117')]: "Конец Святок"
						}
					},
					{
						name: 'Мытаря и фарисея',
						desc: `За 2 недели до Великого Поста, начальная подготовка к посту`,
						items: {
							[convert('E-69')]: "Начало седмицы Мытаря и Фарисея",
							[convert('E-63')]: "Конец седмицы Мытаря и Фарисея"
						}
					},
					{
						name: 'Сырная (масленица)',
						desc: `Неделя перед Великим Постом (без мяса)`,
						items: {
							[convert('E-55')]: "Начало Сырной седмицы",
							[convert('E-49')]: "Конец Сырной седмицы"
						}
					},
					{
						name: 'Пасхальная (Светлая)',
						desc: `Неделя после Пасхи`,
						items: {
							[convert('E+1')]: "Начало Светлой седмицы",
							[convert('E+7')]: "Конец Светлой седмицы"
						}
					},
					{
						name: 'Троицкая',
						desc: `Неделя после Троицы`,
						items: {
							[convert('E+50')]: "Начало Троицкой седмицы",
							[convert('E+56')]: "Конец Троицкой седмицы"
						}
					}
				]
			};
			break;

			case 'commemoration': {
				data = {
					title: 'Особые дни поминовения усопших',
					description: `
					Дни особого общего поминовения усопших называются родительскими субботами.
					В эти дни поминаются все от века умершие христиане.
					`,
					holidays: [{
						items: {
							[convert('SU~0207')]: "Поминовение пострадавших в годину гонений за веру Христову",
							[convert('E-57')]: "Мясопустная вселенская родительская суббота",
							[convert('E-36')]: "Родительская суббота 2-й седмицы Великого Поста",
							[convert('E-29')]: "Родительская суббота 3-й седмицы Великого Поста",
							[convert('E-22')]: "Родительская суббота 4-й седмицы Великого Поста",
							[convert('E+9')]: "Радоница (во вторник второй седмицы после Пасхи)",
							[convert('E+48')]: "Троицкая вселенская родительская суббота",
							[convert('Y0509')]: "День поминовения всех погибших в период Великой Отечественной войны",
							[convert('Y1030')]: "Поминовение всех православных христиан, безвинно богоборцами убиенных или безвинно пребывавших в заключении",
							[convert('SA<1108')]: "Димитриевская родительская суббота",
						}
					}]
				};

				const items = data.holidays[0].items;

				// Предпразднство и сам праздник Благовещения
				const badKeys = Object.keys(items).filter((key) => {
					return [`${year}0406`, `${year}0407`].includes(key) &&
						/родительская/i.test(items[key]);
				});

				// Если день победы в светлую - переносим на радоницу.
				const victoryDay = convert('Y0509');
				if ( victoryDay >= convert('E+1') &&
					victoryDay <= convert('E+7') ) {
					badKeys.push(victoryDay);

					const radonitsa = convert('E+9');
					items[radonitsa] += ", поминовение всех погибших в период ВОВ (перенесено с 9 мая)"
				}


				badKeys.forEach(key => {
					delete items[key];
				});
			}
			break;
		}

		return { ...data, type, year};
	};
</script>
